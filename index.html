<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å°èŠ±è€å¸«çš„æ•¸ç¹”éŠæˆ²</title>
    <style>
        body { font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif; text-align: center; background-color: #fffae8; margin: 0; padding: 20px; }
        h1 { color: #5d4037; margin-bottom: 10px; }
        
        /* é¸å–®æŒ‰éˆ•å€ */
        .menu { margin-bottom: 20px; }
        .level-btn {
            font-size: 18px; padding: 10px 20px; margin: 5px;
            border: none; border-radius: 15px; cursor: pointer;
            color: white; font-weight: bold;
            transition: transform 0.1s;
        }
        .level-btn:active { transform: scale(0.95); }
        .btn-4 { background-color: #81c784; } /* ç¶ è‰² */
        .btn-5 { background-color: #64b5f6; } /* è—è‰² */
        .btn-6 { background-color: #ba68c8; } /* ç´«è‰² */

        /* æ“ä½œå€ */
        .controls { margin-top: 15px; margin-bottom: 15px; }
        .check-btn {
            padding: 12px 30px; font-size: 20px;
            background: #ffb74d; border: none; border-radius: 30px;
            cursor: pointer; color: white; font-weight: bold;
            box-shadow: 0 4px #e65100; /* æŒ‰éˆ•ç«‹é«”æ„Ÿ */
        }
        .check-btn:active { box-shadow: 0 0 #e65100; transform: translateY(4px); }

        /* éŠæˆ²å€åŸŸ */
        .game-wrapper {
            display: flex; justify-content: center; align-items: center;
        }
        .game-board {
            display: inline-grid;
            gap: 2px;
            background-color: #8d6e63;
            border: 5px solid #5d4037;
            padding: 5px;
            border-radius: 10px;
        }

        /* æç¤ºæ•¸å­— */
        .hint {
            background-color: #fff3e0; color: #5d4037;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; font-weight: bold;
            white-space: pre-line; line-height: 1.2;
        }
        .hint.row { justify-content: flex-end; padding-right: 8px; }
        .hint.col { flex-direction: column; justify-content: flex-end; padding-bottom: 5px; }

        /* æ ¼å­ */
        .cell {
            width: 45px; height: 45px; /* æ ¼å­åŠ å¤§ï¼Œé©åˆå°æœ‹å‹ */
            background-color: white; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px; user-select: none;
        }
        .cell.filled { background-color: #5d4037; }
        .cell.x-mark { color: #e57373; }
        .cell:hover { background-color: #f1f1f1; }

        /* çµæœè¨Šæ¯ */
        #message { margin-top: 20px; font-size: 24px; font-weight: bold; height: 40px; color: #5d4037; }
        .instructions { color: #888; font-size: 14px; margin-bottom: 10px;}
    </style>
</head>
<body>

    <h1>ğŸ§¶ å°èŠ±è€å¸«çš„æ•¸ç¹”æŒ‘æˆ°</h1>
    <p class="instructions">é¸æ“‡é›£åº¦ï¼Œé–‹å§‹æŒ‘æˆ°å§ï¼<br>æ»‘é¼ å·¦éµã€Œå¡—é»‘ã€ï¼ŒæŒ‰ä½ Shift é»æ“Šå¯ã€Œæ‰“å‰ã€</p>

    <div class="menu">
        <button class="level-btn btn-4" onclick="startGame(4)">ğŸŒ± ç°¡å–® (4x4)</button>
        <button class="level-btn btn-5" onclick="startGame(5)">ğŸŒ¼ æ™®é€š (5x5)</button>
        <button class="level-btn btn-6" onclick="startGame(6)">ğŸŒ² æŒ‘æˆ° (6x6)</button>
    </div>

    <div class="game-wrapper">
        <div id="board" class="game-board" style="display:none;">
            </div>
    </div>

    <div class="controls">
        <button id="checkBtn" class="check-btn" onclick="checkWin()" style="display:none;">æª¢æŸ¥ç­”æ¡ˆ</button>
    </div>
    
    <div id="message">è«‹é¸æ“‡ä¸€å€‹é—œå¡ï¼</div>

    <script>
        let solution = [];     // å­˜æ”¾æ­£ç¢ºç­”æ¡ˆ
        let userGrid = [];     // å­˜æ”¾å­¸ç”Ÿçš„ç­”æ¡ˆ
        let currentSize = 0;   // ç›®å‰çš„å°ºå¯¸

        // 1. ç”¢ç”Ÿéš¨æ©Ÿé¡Œç›®çš„é­”æ³•å‡½æ•¸
        function generateRandomSolution(size) {
            let newSolution = [];
            for (let r = 0; r < size; r++) {
                let row = [];
                for (let c = 0; c < size; c++) {
                    // æ“²ç¡¬å¹£ï¼š50% æ©Ÿç‡æ˜¯ 1 (é»‘)ï¼Œ50% æ˜¯ 0 (ç™½)
                    row.push(Math.random() < 0.5 ? 1 : 0);
                }
                newSolution.push(row);
            }
            // æ€•é‹æ°£å¤ªå¥½å…¨ç™½æˆ–å…¨é»‘ï¼Œé€™è£¡å¯ä»¥åŠ æª¢æŸ¥ï¼Œä½†å°å°å­©ä¾†èªªç°¡å–®ç©å³å¯
            return newSolution;
        }

        // 2. è¨ˆç®—æç¤ºæ•¸å­—
        function calculateHints(arr) {
            let hints = [];
            let count = 0;
            for (let val of arr) {
                if (val === 1) count++;
                else if (count > 0) {
                    hints.push(count);
                    count = 0;
                }
            }
            if (count > 0) hints.push(count);
            if (hints.length === 0) hints.push(0);
            return hints;
        }

        // 3. é–‹å§‹éŠæˆ² (ç•¶æŒ‰ä¸‹æŒ‰éˆ•æ™‚åŸ·è¡Œ)
        function startGame(size) {
            currentSize = size;
            solution = generateRandomSolution(size); // ç”¢ç”Ÿéš¨æ©Ÿé¡Œç›®
            userGrid = Array.from({ length: size }, () => Array(size).fill(0)); // æ¸…ç©ºå­¸ç”Ÿç­”æ¡ˆ

            const board = document.getElementById('board');
            board.innerHTML = ''; // æ¸…é™¤èˆŠçš„æ ¼å­
            board.style.display = 'inline-grid';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('message').innerText = "éŠæˆ²é–‹å§‹ï¼åŠ æ²¹ï¼";
            document.getElementById('message').style.color = "#5d4037";

            // è¨­å®š CSS Grid æ’ç‰ˆ
            board.style.gridTemplateColumns = `60px repeat(${size}, 45px)`;
            board.style.gridTemplateRows = `60px repeat(${size}, 45px)`;

            // --- ç¹ªè£½ä¸Šæ–¹æç¤º ---
            board.appendChild(createDiv('hint')); 
            for (let c = 0; c < size; c++) {
                let colData = [];
                for (let r = 0; r < size; r++) colData.push(solution[r][c]);
                board.appendChild(createDiv('hint col', calculateHints(colData).join('\n')));
            }

            // --- ç¹ªè£½æ¯ä¸€åˆ— ---
            for (let r = 0; r < size; r++) {
                // å·¦å´æç¤º
                board.appendChild(createDiv('hint row', calculateHints(solution[r]).join(' ')));

                // æ ¼å­
                for (let c = 0; c < size; c++) {
                    let cell = createDiv('cell');
                    cell.addEventListener('click', (e) => handleInput(r, c, cell, e.shiftKey));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleInput(r, c, cell, true);
                    });
                    board.appendChild(cell);
                }
            }
        }

        function createDiv(className, text = '') {
            let div = document.createElement('div');
            div.className = className;
            div.innerText = text;
            return div;
        }

        function handleInput(r, c, cell, isMarking) {
            const current = userGrid[r][c];
            // é‚è¼¯ï¼š0(ç™½) -> 1(é»‘) -> 2(å‰) -> 0(ç™½)
            if (isMarking) {
                if (current === 2) {
                    userGrid[r][c] = 0; cell.innerText = ''; cell.classList.remove('x-mark');
                } else {
                    userGrid[r][c] = 2; cell.innerText = 'X'; cell.classList.remove('filled'); cell.classList.add('x-mark');
                }
            } else {
                if (current === 1) {
                    userGrid[r][c] = 0; cell.classList.remove('filled');
                } else {
                    userGrid[r][c] = 1; cell.classList.add('filled'); cell.innerText = ''; cell.classList.remove('x-mark');
                }
            }
        }

        function checkWin() {
            let isCorrect = true;
            for (let r = 0; r < currentSize; r++) {
                for (let c = 0; c < currentSize; c++) {
                    let ans = solution[r][c];
                    let usr = userGrid[r][c] === 1 ? 1 : 0;
                    if (ans !== usr) { isCorrect = false; break; }
                }
            }
            const msg = document.getElementById('message');
            if (isCorrect) {
                msg.style.color = 'green';
                msg.innerText = "ğŸ‰ å¥½æ£’å–”ï¼ä½ éé—œäº†ï¼";
            } else {
                msg.style.color = 'red';
                msg.innerText = "ğŸ’ª é‚„å·®ä¸€é»é»ï¼Œå†æª¢æŸ¥çœ‹çœ‹ï¼";
            }
        }
    </script>
</body>
</html>
