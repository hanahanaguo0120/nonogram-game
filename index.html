<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å°èŠ±è€å¸«çš„æ•¸ç¹”æŒ‘æˆ°</title>
    <style>
        body { font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif; text-align: center; background-color: #fffae8; margin: 0; padding: 20px; }
        h1 { color: #5d4037; font-size: 24px; }
        .controls { margin-bottom: 15px; }
        button { padding: 10px 20px; font-size: 16px; background: #ffb74d; border: none; border-radius: 20px; cursor: pointer; color: white; font-weight: bold; }
        button:hover { background: #ff9800; }
        
        /* éŠæˆ²å€åŸŸä½ˆå±€ */
        .game-board {
            display: inline-grid;
            /* é€™è£¡çš„ grid-template æœƒç”± JS å‹•æ…‹è¨­å®š */
            gap: 2px;
            background-color: #8d6e63; /* æ ¼ç·šé¡è‰² */
            border: 5px solid #5d4037;
            padding: 5px;
            border-radius: 10px;
        }

        /* æç¤ºæ•¸å­—å€ */
        .hint {
            background-color: #fff3e0;
            color: #5d4037;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            white-space: pre-line; /* è®“æ•¸å­—å¯ä»¥æ›è¡Œ */
            line-height: 1.2;
        }
        .hint.row { justify-content: flex-end; padding-right: 5px; }
        .hint.col { flex-direction: column; justify-content: flex-end; padding-bottom: 5px; }

        /* æ ¼å­æ¨£å¼ */
        .cell {
            width: 40px; height: 40px;
            background-color: white;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; user-select: none;
        }
        .cell.filled { background-color: #5d4037; } /* å¡—é»‘ */
        .cell.x-mark { color: #e57373; } /* æ‰“å‰ */
        .cell:hover { background-color: #eee; }

        /* çµæœè¨Šæ¯ */
        #message { margin-top: 20px; font-size: 20px; font-weight: bold; height: 30px; }
    </style>
</head>
<body>

    <h1>ğŸ§¶ å°èŠ±è€å¸«çš„æ•¸ç¹”éŠæˆ² (Level 1)</h1>
    
    <div class="controls">
        <p>æ“ä½œèªªæ˜ï¼šæ»‘é¼ å·¦éµã€Œå¡—é»‘ã€ï¼ŒæŒ‰ä½ Shift é»æ“Šå¯ã€Œæ‰“å‰ã€</p>
        <button onclick="checkWin()">æª¢æŸ¥ç­”æ¡ˆ</button>
    </div>

    <div id="board" class="game-board">
        </div>

    <div id="message"></div>

    <script>
        // ==========================================
        // è€å¸«è«‹æ”¹é€™è£¡ï¼é€™å°±æ˜¯æ‚¨çš„ã€Œé¡Œç›®è¨­è¨ˆåœ–ã€
        // 1 = å¡—é»‘, 0 = ç©ºç™½
        // ==========================================
        const solution = [
            [0, 1, 0, 1, 0],
            [1, 1, 1, 1, 1],
            [1, 1, 1, 1, 1],
            [0, 1, 1, 1, 0],
            [0, 0, 1, 0, 0]
        ];
        // ==========================================

        const rows = solution.length;
        const cols = solution[0].length;
        const board = document.getElementById('board');
        let userGrid = Array.from({ length: rows }, () => Array(cols).fill(0));

        // 1. è¨ˆç®—æç¤ºæ•¸å­—çš„å‡½æ•¸
        function calculateHints(arr) {
            let hints = [];
            let count = 0;
            for (let val of arr) {
                if (val === 1) {
                    count++;
                } else if (count > 0) {
                    hints.push(count);
                    count = 0;
                }
            }
            if (count > 0) hints.push(count);
            if (hints.length === 0) hints.push(0);
            return hints;
        }

        function initGame() {
            // è¨­å®š CSS Grid ä½ˆå±€ï¼šå¤šåŠ ä¸€è¡Œä¸€åˆ—çµ¦æç¤ºæ•¸å­—
            board.style.gridTemplateColumns = `60px repeat(${cols}, 40px)`;
            board.style.gridTemplateRows = `60px repeat(${rows}, 40px)`;

            // --- ç”¢ç”Ÿä¸Šæ–¹æç¤º (Column Hints) ---
            board.appendChild(createDiv('hint')); // å·¦ä¸Šè§’ç©ºç™½æ ¼
            for (let c = 0; c < cols; c++) {
                let colData = [];
                for (let r = 0; r < rows; r++) colData.push(solution[r][c]);
                let hints = calculateHints(colData);
                let div = createDiv('hint col', hints.join('\n')); // å‚ç›´æ’åˆ—
                board.appendChild(div);
            }

            // --- ç”¢ç”Ÿæ¯ä¸€åˆ— (Row Hints + Cells) ---
            for (let r = 0; r < rows; r++) {
                // å·¦å´æç¤º (Row Hints)
                let rowData = solution[r];
                let hints = calculateHints(rowData);
                let div = createDiv('hint row', hints.join(' ')); // æ°´å¹³æ’åˆ—
                board.appendChild(div);

                // æ ¼å­
                for (let c = 0; c < cols; c++) {
                    let cell = createDiv('cell');
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    
                    // é»æ“Šäº‹ä»¶
                    cell.addEventListener('click', (e) => {
                        handleInput(r, c, cell, e.shiftKey);
                    });
                    // é˜²æ­¢å³éµé¸å–®è·³å‡ºä¾† (ç‚ºäº†æ–¹ä¾¿ä»¥å¾ŒåŠ å³éµåŠŸèƒ½)
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleInput(r, c, cell, true); // å³éµç›´æ¥ç•¶ä½œæ‰“å‰
                    });
                    
                    board.appendChild(cell);
                }
            }
        }

        function createDiv(className, text = '') {
            let div = document.createElement('div');
            div.className = className;
            div.innerText = text;
            return div;
        }

        function handleInput(r, c, cell, isMarking) {
            const current = userGrid[r][c];
            
            // ç‹€æ…‹å¾ªç’°ï¼š0(ç™½) -> 1(é»‘) -> 2(å‰) -> 0(ç™½)
            // ç‚ºäº†ç°¡å–®ï¼Œæˆ‘å€‘ç”¨ï¼šå·¦éµ(é»‘/ç™½åˆ‡æ›)ï¼ŒShift/å³éµ(å‰/ç™½åˆ‡æ›)
            
            if (isMarking) { // æ‰“å‰æ¨¡å¼
                if (current === 2) {
                    userGrid[r][c] = 0;
                    cell.innerText = '';
                    cell.classList.remove('x-mark');
                } else {
                    userGrid[r][c] = 2;
                    cell.innerText = 'X';
                    cell.classList.remove('filled');
                    cell.classList.add('x-mark');
                }
            } else { // å¡—é»‘æ¨¡å¼
                if (current === 1) {
                    userGrid[r][c] = 0;
                    cell.classList.remove('filled');
                } else {
                    userGrid[r][c] = 1;
                    cell.classList.add('filled');
                    cell.innerText = '';
                    cell.classList.remove('x-mark');
                }
            }
        }

        function checkWin() {
            let isCorrect = true;
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    // æª¢æŸ¥é‚è¼¯ï¼šé¡Œç›®æ˜¯1çš„åœ°æ–¹ï¼Œç©å®¶å¿…é ˆå¡«1ï¼›é¡Œç›®æ˜¯0çš„åœ°æ–¹ï¼Œç©å®¶ä¸èƒ½å¡«1 (å¡«0æˆ–2éƒ½å¯ä»¥)
                    let answer = solution[r][c];
                    let user = userGrid[r][c] === 1 ? 1 : 0; // æŠŠæ‰“å‰(2)ç•¶ä½œç©ºç™½(0)ä¾†æª¢æŸ¥
                    
                    if (answer !== user) {
                        isCorrect = false;
                        break;
                    }
                }
            }

            const msg = document.getElementById('message');
            if (isCorrect) {
                msg.style.color = 'green';
                msg.innerText = "ğŸ‰ æ­å–œå°èŠ±è€å¸«ï¼ç­”å°äº†ï¼";
            } else {
                msg.style.color = 'red';
                msg.innerText = "âŒ é‚„æ²’å®Œæˆå–”ï¼Œå†æª¢æŸ¥ä¸€ä¸‹ï¼";
            }
        }

        // å•Ÿå‹•éŠæˆ²
        initGame();
    </script>
</body>
</html>
